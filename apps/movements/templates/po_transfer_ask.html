{% extends "base.html" %}
{% load i18n %}
{% load styling %}
{% load generic_views_helpers %}
{% block title %} :: {% with "true" as read_only %}{% with "true" as striptags %}{% include "calculate_form_title.html" %}{% endwith %}{% endwith %}{% endblock %}

{% block javascript %}
    <script type="text/javascript">
    $(function() {
        $("#subform form :input").each(function() {
            this.disabled = true;
        });
    });
    </script>
{% endblock %}

{% block sidebar %}
    {% for subtemplate in sidebar_subtemplates %}
        {% include subtemplate %}
    {% endfor %}
{% endblock %}

{% block stylesheets %}
    <style type="text/css">
        #subform form  textarea, 
        #subform form  select option,
        #subform form  input, 
        #subform form  select, 
        #subform form  input { background: none; color: black; border: none; }
    </style>
{% endblock %}

{% block content %}
    <div id="subform">
        {% with "true" as read_only %}
            {% include "generic_form_subtemplate.html" %}
        {% endwith %}
    </div>

    {% for subtemplate in subtemplates %}
        {% include subtemplate %}
    {% endfor %}

    {% for subtemplate in subtemplates_dict %}
    {% with subtemplate.title as title %}
    {% with subtemplate.object_list as object_list %}
    {% with subtemplate.extra_columns as extra_columns %}
    {% with subtemplate.hide_object as hide_object %}
    {% with subtemplate.hide_links as hide_links %}
    {% with subtemplate.main_object as main_object %}
        {% include subtemplate.name %}
    {% endwith %}
    {% endwith %}
    {% endwith %}
    {% endwith %}
    {% endwith %}
    {% endwith %}
    {% endfor %}

    <div class="content">
   {% if more_items_count %}
	<div id="create_moves_form">
	<form method="GET" >
	  <p>{% trans 'There are still items received that have not been acknowledged in a movement.' %}</p>
          <p>{% trans 'Do you want a new movement for these received items?' %}</p>
            {% if ask_location %}
            <div class="group">
                <span id="id_location_ask_wrapper">
                <label for="id_location_ask_text">{% trans 'Location' %}</label>
                <input type="text" name="location_ask_text" id="id_location_ask_text" value=""
                        class="text_field ui-autocomplete-input" maxlength="255" 
                        autocomplete="off" role="textbox" aria-autocomplete="list" 
                        aria-haspopup="true">
                <input type="hidden" name="location_ask" id="id_location_ask" value="">
                <div id="id_location_ask_on_deck" class="results_on_deck"><div></div></div>
<script type="text/javascript">//<![CDATA[
jQuery(document).ready(function($){
        addAutoComplete("id_location_ask", function(html_id) {
                $("#"+html_id).autocompleteselect({"min_length": 1, "source": "/ajax_select/ajax_lookup/location"});
        });
});//]]>
</script>
                </span>
            </div>
            {% endif %}
          <div class="group navform wat-cf">
            <input type="hidden" name="do_create" value="1" />
            <button class="button" type="submit">
                <img src="{{ STATIC_URL }}theme/images/tick.png" 
                        alt="{% trans 'Create Movement' %}" />{% trans 'Create' %}
            </button>
          </div>
        </form>
        </div>
    {% else %} {# no pending items, we may confirm #}
        {% if object.state == 'draft' or object.state == 'pending' %}
            {% if confirm_ask %}
        <div id="confirm_form">
        <form method="GET" >
          <p>{% blocktrans %}Do you want to mark all movements as done and close this Purchase Order? {% endblocktrans %}</p>
          <div class="group navform wat-cf">
            <input type="hidden" name="do_confirm" value="1" />
            <div class="group">
                <label for="reference_ask">{% trans 'Reference' %}</label>
                <input type="text" name="reference_ask">
            </div>
            <button class="button" type="submit">
                <img src="{{ STATIC_URL }}theme/images/tick.png" 
                        alt="{% trans 'Confirm Order' %}" />{% trans 'Confirm' %}
            </button>
          </div>
        </form>
        </div>
            {% else %}
        <div id="confirm_form">
          <p>{% blocktrans %}Some movements by other Departments are still pending. The order will be confirmed once all of them have confirmed.{% endblocktrans %}</p>
        </div>
            {% endif %}
        {% endif %}
    {% endif %}
</div>
{% endblock %}

