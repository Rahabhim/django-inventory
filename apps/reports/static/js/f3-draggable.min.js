/*    According to this:
        http://stackoverflow.com/questions/3097332/jquery-drag-droppable-scope-issue
    and http://forum.jquery.com/topic/draggable-droppable-scope-bug
    
    */angular.module("f3.draggable",[]).directive("ngShowFocused",["$timeout",function(e){return function(t,n,r){t.$watch(r.ngShow,function(r){r&&e(function(){n.focus()})})}}]).directive("ngDraggable",["$log","$parse",function(e,t){return{require:"?ngDroppable",restrict:"A",link:function(e,t,n){var r,i=function(r,i){var s=0;if(r){var o={disabled:!1,addClasses:!1,helper:"clone",revert:"invalid",scroll:!0,delay:100,distance:10};n.jqyouiOptions&&angular.extend(o,e.$eval(n.jqyouiOptions));var u=!1;n.ngDragModel&&(u=e.$eval(n.ngDragModel)),o.start=function(n,r){t.addClass("ui-beingdragged"),s=$(this).css("z-index"),$(this).css("z-index",99999),e._dragItem=u},o.stop=function(n,r){t.removeClass("ui-beingdragged"),$(this).css("z-index",s),e._dragItem=!1},t.draggable(o)}else t.draggable({disabled:!0})};e.$watch(function(){return e.$eval(n.ngDraggable)},i),i()}}}]).directive("ngDroppable",["$log","$parse",function(e,t){return{restrict:"A",priority:1,compile:function(n,r){var i=function(t,n){e.info("drop: "+n.draggable)};return r.ngOndrop&&(i=t(r.ngOndrop)),{post:function(e,t,n){var r=function(r,s){if(r){var o={disabled:!1,activeClass:"ui-state-highlight",addClasses:!1,hoverClass:"ui-drop-hover"};n.jqyouiOptions&&angular.extend(o,e.$eval(n.jqyouiOptions)),o.drop=function(n,r){var s={drop_event:n,drop_position:r.position,drop_offset:r.offset,dropElem:t,dragElem:angular.element(r.draggable)};s.dragItem=s.dragElem.scope()._dragItem,i(e,s)&&(r.helper.remove(),e.$apply())};var u=o.scope;delete o.scope,t.droppable(o),u&&t.setDroppableScope(u)}else t.droppable({disabled:!0})};e.$watch(function(){return e.$eval(n.ngDroppable)},r),r()}}}}}]).directive("ngBlur",function(){return function(e,t,n){t.bind("blur",function(){e.$apply(n.ngBlur)})}}),jQuery.fn.extend({setDroppableScope:function(e){return this.each(function(){var t=$(this).droppable("option","scope");if(typeof t=="object"&&t[0]==this)return!0;var n,r;for(n=0;n<$.ui.ddmanager.droppables[t].length;n++){var i=$.ui.ddmanager.droppables[t][n].element[0];if(this==i){r=$.ui.ddmanager.droppables[t].splice(n,1)[0],$.ui.ddmanager.droppables[e]=$.ui.ddmanager.droppables[e]||[],$.ui.ddmanager.droppables[e].push(r),$(this).droppable("option","scope",e);break}}})}});