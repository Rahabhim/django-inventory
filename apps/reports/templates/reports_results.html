{% extends "base-bare.html" %}
{% load i18n %}

{% block title %}
        {{ report_data.title }}
{% endblock %}
{% block web_theme_project_name %}{% trans 'Report builder' %}{% endblock %}

{% block stylesheets %}
    {{ block.super }}
    <link rel="stylesheet" href="{{ STATIC_URL }}css/reports-widgets.css" type="text/css"/>
{% endblock %}

{% block web_theme_sidebar %}
    <div class="block">
        <h3>{% trans 'Actions' %}</h3>
        <ul class="navigation">
            <li class="print"><a onclick="window.print()"><span class="famfam active famfam-printer"></span>{% trans 'Print this report' %}</a></li>
        </ul>
    </div>
{% endblock %}

{% block web_theme_javascript %}
    {# using web_theme.. and not just "javascript", to hide 2 unused scripts #}
<script type="text/javascript">
    function toggleExpand(elem) {
        var par = $(elem).parent();
        // console.log("Toggle expand", elem, par, );
        if (par.hasClass('collapsed'))
            par.removeClass('collapsed').addClass('expanded');
        else
            par.removeClass('expanded').addClass('collapsed');
    }
    function expandAll() {
        $('.report-results .group').removeClass('collapsed').addClass('expanded');
    }
    function collapseAll() {
         $('.report-results .group').removeClass('expanded').addClass('collapsed');
    }
</script>
{% endblock %}

{% block content %}

    <h2>{{ report_data.title }}</h2>
<p>{% trans 'Printed at:' %} {{ current_time|date:"SHORT_DATETIME_FORMAT" }}</p>
{% if report_data.notes %}
    <p>{{ report_data.notes|linebreaks }}</p>
{% endif %}
<div class="report-results final">
    <div class="count">{% trans "Number of results:" %} {{ count }}
        {% if report_data.limit and report_data.limit < count %}
        {% with report_data.limit as limit %}
        {% blocktrans %}( showing only {{ limit }} records ) {% endblocktrans %}
        {% endwith %}
        {% endif %}
    </div>
{% if flat_results %}
    {% with cur_results=flat_results %}
        {% include "sub_results.html" %}
    {% endwith %}
{% elif groupped_results %}
    <div class="links_options">
        <div><a onclick="expandAll()"><span class="famfam active famfam-magnifier_zoom_in"></span>{% trans "Expand all" %}</a></div>
        <div><a onclick="collapseAll()"><span class="famfam active famfam-magifier_zoom_out"></span>{% trans "Collapse all" %}</a></div>
    </div>
    {% with group_level=0 %}
        {% include "grp_results.html" %}
    {% endwith %}
    <div class="links_options">
        <div><a onclick="expandAll()"><span class="famfam active famfam-magnifier_zoom_in"></span>{% trans "Expand all" %}</a></div>
        <div><a onclick="collapseAll()"><span class="famfam active famfam-magifier_zoom_out"></span>{% trans "Collapse all" %}</a></div>
        <div><a onclick="window.print()"><span class="famfam active famfam-printer"></span>{% trans 'Print this report' %}</a></div>
    </div>
{% else %}
    <p class="error">{% trans "Internal error: no results!" %}</p>
{% endif %}
    <div class="count">{% trans "Number of results:" %} {{ count }}</div>
</div>
{% endblock %}