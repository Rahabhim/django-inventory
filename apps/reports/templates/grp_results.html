{% load i18n %}
{% load report_tags %}

{% group_recurse %}

{% if group_by %}
    {% if group_mode == 'table' %}
        {% if render_head %}
        <table class="grp_results">
            <thead>
            <tr>{% for fc in render_head %}
                <th>{{ fc.name|title }}</th>
                {% endfor %}
            </tr>
            </thead>
            <tbody>
        {% endif %}
            {% for cur_row in cur_results %}
            <tr class="right_table">
                {% for fc in field_cols %}
                <td >{% if fc.widget == 'boolean' or fc.widget == 'extra_condition' %}
                     {% if cur_row|attrib:fc.id %}{% trans 'True'%}{% else %}{%trans 'False' %}{%endif %}
                     {% elif fc.widget == 'has_sth' %}
                     {% if cur_row|attrib:fc.id %}{% trans 'has'%}{% else %}{%trans "doesn't have" %}{%endif %}
                     {% else %}{{ cur_row|attrib:fc.id|default:'-' }}{% endif %}
                </td>
                {% endfor %}
            </tr>
            {% if has_sub_values %}
            <tr>
                <td colspan="{{ field_cols|length }}" class="right_part">
                    <div>
                        {{ do_group_recurse }}
                    </div>
                </td>
            </tr>
            {% endif %}
            {% endfor %}
        {% if render_head %}
        </tbody>
        </table>
        {% endif %}
    {% elif group_mode == 'left_col' %}
        {% if render_head %}
        <table class="grp_left_col">
            <thead>
            <tr>{% for fc in render_head %}
                <th>{% if fc.name != '-'%}{{ fc.name }}{% endif %}</th>
                {% endfor %}
            </tr>
            </thead>
            <tbody>
        {% endif %}
            {% for cur_row in cur_results %}
            <tr class="left_row">
                <td class="left_col" rowspan="{{ get_rowspan }}">
                    {% for fc in field_cols %}
                    <div>
                        {% if fc.name and fc.name != '-'%}
                        <span >{{ fc.name }}:</span>
                        {% endif %}
                     {% if fc.widget == 'boolean' or fc.widget == 'extra_condition' %}
                     {% if cur_row|attrib:fc.id %}{% trans 'True'%}{% else %}{%trans 'False' %}{%endif %}
                     {% elif fc.widget == 'has_sth' %}
                     {% if cur_row|attrib:fc.id %}{% trans 'has'%}{% else %}{%trans "doesn't have" %}{%endif %}
                     {% else %}{{ cur_row|attrib:fc.id|default:'-' }}{% endif %}
                    </div>
                    {% endfor %}
                    <div class="count">({{ cur_row|dvalue:'_count' }})</div>
                </td>
            </tr>
            {{ do_group_recurse }}
            {% endfor %}
        {% if render_head %}
        </tbody>
        </table>
        {% endif %}
    {% else %}
        {% for cur_row in cur_results %}
          {% if in_table %}
            <tr><td class="right_part">
          {% endif %}
            <div class="group expanded">
            <h4 onclick="toggleExpand(this)"><span class="arrow-img">&nbsp;</span>
                {% for fc in field_cols %}
                <span>{% if fc.name and fc.name != '-' %}<span>{{ fc.name }}:</span>{% endif %}
                     {% if fc.widget == 'boolean' or fc.widget == 'extra_condition' %}
                     {% if cur_row|attrib:fc.id %}{% trans 'True'%}{% else %}{%trans 'False' %}{%endif %}
                     {% elif fc.widget == 'has_sth' %}
                     {% if cur_row|attrib:fc.id %}{% trans 'has'%}{% else %}{%trans "doesn't have" %}{%endif %}
                     {% else %}{{ cur_row|attrib:fc.id|default:'-' }}{% endif %}
                </span>
                {% endfor %}
                ({{ cur_row|dvalue:"_count" }})
            </h4>
            <div>
                {{ do_group_recurse }}
            </div>
            </div>
          {% if in_table %}
            </tr></td>
          {% endif %}
        {% endfor %}
    {% endif %}
{% else %}
    {% if render_head %}
      <table class="detail-results">
        <thead>
        <tr>
            {% for fc in render_head %}
            <th>{% if fc.name != '-' %}{{ fc.name|title }}{% endif %}</th>
            {% endfor %}
        </tr>
        </thead>
        <tbody>
    {% endif %}
        {% include 'sub_results.html' %}
    {% if render_head %}
        </tbody>
    </table>
    {% endif %}
{% endif %}
{% end_group_recurse %}

